<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JSON Formatter</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body class="bg-slate-50">
  <main class="container py-4">
    <div class="d-flex align-items-center mb-3">
      <div>
        <p class="mb-1 text-muted small">Utility-first + components</p>
        <h1 class="h3 mb-0 fw-semibold">JSON Formatter & Key Finder</h1>
      </div>
    </div>

    {{if .Error}}
    <div class="alert alert-danger d-flex align-items-center" role="alert">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-exclamation-triangle me-2" viewBox="0 0 16 16">
        <path d="M7.938 2.016a1.13 1.13 0 0 1 2.122 0l6.857 11.667c.457.778-.091 1.767-.999 1.767H2.08c-.908 0-1.456-.99-.999-1.767L7.938 2.016zM8 5c-.535 0-.954.462-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 5zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
      </svg>
      <div>{{.Error}}</div>
    </div>
    {{end}}

    <form method="POST" action="/format" class="row g-3 mb-4">
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="mb-3">
              <label for="jsonInput" class="form-label fw-semibold">JSON Input</label>
              <textarea id="jsonInput" name="jsonInput" rows="16" class="form-control font-mono text-sm shadow-none" placeholder="Paste JSON here">{{.RawInput}}</textarea>
            </div>
            <div class="d-flex flex-wrap gap-2 justify-content-end">
              <button type="submit" class="btn btn-primary px-4 py-2 fw-semibold">Format</button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white d-flex align-items-center justify-content-between">
            <span class="fw-semibold">Formatted JSON</span>
            <button type="button" id="copyFormatted" data-target="formattedOutput" class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                <path d="M4 1.5H3a2 2 0 0 0-2 2V12a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2v-.5H4a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h.5V1.5z"/>
                <path d="M9.5 0A1.5 1.5 0 0 1 11 1.5v10A1.5 1.5 0 0 1 9.5 13h-5A1.5 1.5 0 0 1 3 11.5v-10A1.5 1.5 0 0 1 4.5 0h5zm0 1h-5a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5v-10a.5.5 0 0 0-.5-.5"/>
              </svg>
            </button>
          </div>
          <div class="card-body">
            <pre id="formattedOutput" class="font-mono text-sm bg-slate-900 text-slate-100 rounded p-3 border border-slate-800 whitespace-pre-wrap overflow-auto" style="min-height: 320px; max-height: 520px;">{{.Formatted}}</pre>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white fw-semibold">Key search</div>
          <div class="card-body d-flex flex-column gap-3">
            <div>
              <label for="key" class="form-label fw-semibold">Key to find (optional)</label>
              <input id="key" name="key" type="text" value="{{.Key}}" class="form-control" placeholder="e.g. name">
              <p class="form-text text-muted mb-2">Case-sensitive exact key match.</p>
              <button type="submit" formaction="/find/key" class="btn btn-outline-primary btn-sm">Find Key</button>
            </div>
            <div>
              <div class="d-flex align-items-center justify-content-between mb-2">
                <span class="fw-semibold">Matches</span>
                {{if .Matches}}
                  <span class="badge text-bg-primary">{{len .Matches}}</span>
                {{end}}
              </div>
              {{if .Matches}}
                <ul class="list-group list-group-flush rounded overflow-hidden">
                  {{range .Matches}}
                    <li class="list-group-item"><code class="text-wrap">{{.}}</code></li>
                  {{end}}
                </ul>
              {{else}}
                <p class="text-muted mb-1">No matches found.</p>
                <p class="text-muted small mb-0">Provide a key to search, or ensure your JSON contains it.</p>
              {{end}}
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white fw-semibold">Value search</div>
          <div class="card-body d-flex flex-column gap-3">
            <div>
              <label for="value" class="form-label fw-semibold">Value to find (optional)</label>
              <input id="value" name="value" type="text" value="{{.Value}}" class="form-control" placeholder='e.g. "alice" or 42 or {"a":1}'>
              <p class="form-text text-muted mb-2">Exact match against string values or JSON-serialized value.</p>
              <button type="submit" formaction="/find/value" class="btn btn-outline-primary btn-sm">Find Value</button>
            </div>
            <div>
              <div class="d-flex align-items-center justify-content-between mb-2">
                <span class="fw-semibold">Keys</span>
                {{if .KeyMatches}}
                  <span class="badge text-bg-success">{{len .KeyMatches}}</span>
                {{end}}
              </div>
              {{if .KeyMatches}}
                <ul class="list-group list-group-flush rounded overflow-hidden">
                  {{range .KeyMatches}}
                    <li class="list-group-item"><code class="text-wrap">{{.}}</code></li>
                  {{end}}
                </ul>
              {{else}}
                <p class="text-muted mb-1">No keys matched that value.</p>
                <p class="text-muted small mb-0">Enter a value to search (exact match).</p>
              {{end}}
            </div>
          </div>
        </div>
      </div>
    </form>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    (() => {
      const btn = document.getElementById('copyFormatted');
      if (!btn) return;
      btn.addEventListener('click', () => {
        const targetId = btn.getAttribute('data-target');
        const pre = document.getElementById(targetId);
        if (!pre) return;
        const text = pre.innerText || pre.textContent || '';
        const reset = (label) => {
          const span = btn.querySelector('.copy-label');
          if (span) span.textContent = label;
        };
        const setTempLabel = (label) => {
          reset(label);
          setTimeout(() => reset('Copy'), 1500);
        };
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(text).then(() => setTempLabel('Copied!')).catch(() => setTempLabel('Copy failed'));
        } else {
          setTempLabel('Unsupported');
        }
      });
    })();
  </script>
</body>
</html>
